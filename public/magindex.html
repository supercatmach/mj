<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.7.5/dist/socket.io.min.js"></script>

</head>
<body>
  <div id="app">
    <h1 style="text-align:center;">è¶…ç§‘å­¸éº»å°‡ç¤¾</h1>
    <div class="table-area">
      <div class="room" v-for="(room, roomId) in rooms" :key="roomId">
        <!-- ç©å®¶ 0 ~ 3 -->
        <template v-for="(p, idx) in room.playerpic">
          <div
            class="player"
            v-if="p"
            :class="'player' + idx"
            :key="p.playerId"
          >
            <img :src="'head/cv' + p.che + 'c.png'" />
            <!-- å°è©±æ³¡æ³¡é¡¯ç¤ºå‡ºç‰Œ -->
<div
  class="outcard-bubble"
  v-if="hallOutcards[roomId] && hallOutcards[roomId][p.playerId]"
>
  {{ hallOutcards[roomId][p.playerId] }}
</div>
          </div>
        </template>

        <!-- æ¡Œå­åœ– -->
        <div class="table">
          <img src="backg/tablesmoll.png" />
        </div>
      </div>
    </div>
  </div>

<style>
    body {
      font-family: sans-serif;
      background: #eee;
    }
.table-area {
  display: flex;
  flex-wrap: wrap;
  gap: 24px;
  justify-content: center;
}

.room {
  position: relative;
  width: 250px;
  height: 250px;
  background: #f0f0f0;
  border-radius: 12px;
  overflow: hidden;
}

.table {
  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 1;
  transform: translate(-50%, -50%);
}

.player {
  position: absolute;
  z-index: 2; /* âœ… è®“ç©å®¶åœ–åƒåœ¨æ¡Œå­ä¸‹é¢å°±èª¿æˆ 0 */
}

.player0 {
  top: 80%;
  left: 50%;
  transform: translate(-50%, -50%);
}
.player1 {
  top: 50%;
  left: 80%;
  transform: translate(-50%, -50%);
}
.player2 {
  top: 20%;
  left: 50%;
  transform: translate(-50%, -50%);
}
.player3 {
  top: 50%;
  left: 20%;
  transform: translate(-50%, -50%);
}

.player img {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  border: 2px solid #555;
  background: white;
}

    .outcard-bubble {
      margin-top: 4px;
      padding: 2px 6px;
      background: white;
      border-radius: 8px;
      border: 1px solid #aaa;
      font-size: 20px;
      line-height: 1.2;
      animation: fadeout 3s forwards;
    }

    @keyframes fadeout {
      0% { opacity: 1; }
      80% { opacity: 1; }
      100% { opacity: 0; }
    }
</style>
    <script>
    const { createApp } = Vue;
    createApp({
      data() {
        return {
          socket: null,
          rooms: {},
          hallOutcards: {}  // å‡ºç‰Œé¡¯ç¤ºæš«å­˜ { [roomId]: { [playerId]: "ğŸ€‡" } }
        };
      },
      mounted() {
        this.socket = io("https://mj-sp1.up.railway.app");
        this.socket.emit("getRooms");

        // æ›´æ–°æˆ¿é–“è³‡æ–™
        this.socket.on("updateRooms", (rooms) => {
          this.rooms = rooms;
        });

        // ç©å®¶æ‰“ç‰Œ
        this.socket.on("outcardtohall", (outcard) => {
          const playerId = outcard[0];
          const [roomId, cardText] = JSON.parse(outcard[1]);

          // è½‰æ›ç‰Œæ–‡å­—ç‚ºå°æ‡‰ç¬¦è™Ÿ
          const cardSymbol = this.cardToUnicode(cardText);
          if (!this.hallOutcards[roomId]) this.hallOutcards[roomId] = {};
          this.hallOutcards[roomId][playerId] = cardSymbol;

          // 3ç§’å¾Œè‡ªå‹•ç§»é™¤
          setTimeout(() => {
            if (this.hallOutcards[roomId]) {
              delete this.hallOutcards[roomId][playerId];
            }
          }, 3000);
        });

        // ğŸ‘‰ æ¸¬è©¦å‡è³‡æ–™ç”¨
        /*
        this.rooms = {
          A001: {
            playerpic: [
              { che: "01", playerId: "a1" },
              { che: "02", playerId: "a2" },
              null,
              { che: "03", playerId: "a4" }
            ]
          }
        };

        setTimeout(() => {
          this.socket.emit("outcardtohall", [
            "a1",
            JSON.stringify(["A001", "1è¬"])
          ]);
        }, 1000);
        */
      },
      methods: {
        // éº»å°‡ç‰Œæ–‡å­—è½‰ Unicode å­—ç¬¦
cardToUnicode(num) {
  if (num >= 1 && num <= 9) return String.fromCodePoint(0x1F007 + (num - 1)); // ğŸ€‡~ğŸ€ è¬
  if (num >= 10 && num <= 18) return String.fromCodePoint(0x1F019 + (num - 10)); // ğŸ€™~ğŸ€¡ ç­’
  if (num >= 19 && num <= 27) return String.fromCodePoint(0x1F010 + (num - 19)); // ğŸ€~ğŸ€˜ æ¢
  const honors = {
    28: 0x1F000, // æ±
    29: 0x1F001, // å—
    30: 0x1F002, // è¥¿
    31: 0x1F003, // åŒ—
    32: 0x1F004, // ä¸­
    33: 0x1F005, // ç™¼
    34: 0x1F006  // ç™½
  };
  return String.fromCodePoint(honors[num] || 0x2753); // ï¼Ÿ(æœªçŸ¥)
}
      }
    }).mount("#app");
    </script>
</body>
</html>